/// Fenton Preterm Growth Chart (2013 Revision)
/// 출처: Fenton TR, Kim JH. A systematic review and meta-analysis to revise the Fenton growth chart for preterm infants. BMC Pediatrics. 2013;13:59.
///
/// 적용 대상: 재태 연령 22-50주 조산아
/// 백분위수: p3, p10, p50, p90, p97
/// - p3: 3백분위수 (성장 부진 주의)
/// - p10: 10백분위수
/// - p50: 50백분위수 (중앙값)
/// - p90: 90백분위수
/// - p97: 97백분위수 (과체중 주의)
///
/// 참고:
/// - 재태 연령은 주 단위로 계산 (예: 34주 5일 = 34주로 반올림)
/// - 50주 이후에는 WHO 성장 곡선 사용 권장

class FentonGrowthData {
  // ============================================
  // 체중 (Weight) - 남아 (g)
  // ============================================
  static const Map<int, Map<String, double>> weightBoys = {
    22: {'p3': 425, 'p10': 460, 'p50': 530, 'p90': 600, 'p97': 635},
    23: {'p3': 480, 'p10': 520, 'p50': 600, 'p90': 680, 'p97': 720},
    24: {'p3': 545, 'p10': 590, 'p50': 685, 'p90': 775, 'p97': 820},
    25: {'p3': 620, 'p10': 670, 'p50': 780, 'p90': 885, 'p97': 935},
    26: {'p3': 705, 'p10': 765, 'p50': 890, 'p90': 1010, 'p97': 1070},
    27: {'p3': 800, 'p10': 870, 'p50': 1015, 'p90': 1155, 'p97': 1220},
    28: {'p3': 910, 'p10': 990, 'p50': 1155, 'p90': 1315, 'p97': 1390},
    29: {'p3': 1030, 'p10': 1120, 'p50': 1310, 'p90': 1490, 'p97': 1575},
    30: {'p3': 1165, 'p10': 1270, 'p50': 1485, 'p90': 1690, 'p97': 1785},
    31: {'p3': 1315, 'p10': 1430, 'p50': 1675, 'p90': 1905, 'p97': 2015},
    32: {'p3': 1480, 'p10': 1610, 'p50': 1885, 'p90': 2145, 'p97': 2270},
    33: {'p3': 1660, 'p10': 1805, 'p50': 2115, 'p90': 2405, 'p97': 2545},
    34: {'p3': 1855, 'p10': 2020, 'p50': 2365, 'p90': 2690, 'p97': 2845},
    35: {'p3': 2070, 'p10': 2250, 'p50': 2635, 'p90': 2995, 'p97': 3165},
    36: {'p3': 2300, 'p10': 2500, 'p50': 2925, 'p90': 3320, 'p97': 3510},
    37: {'p3': 2545, 'p10': 2765, 'p50': 3230, 'p90': 3660, 'p97': 3870},
    38: {'p3': 2800, 'p10': 3040, 'p50': 3545, 'p90': 4015, 'p97': 4245},
    39: {'p3': 3060, 'p10': 3320, 'p50': 3865, 'p90': 4375, 'p97': 4625},
    40: {'p3': 3320, 'p10': 3605, 'p50': 4185, 'p90': 4735, 'p97': 5005},
    41: {'p3': 3575, 'p10': 3885, 'p50': 4500, 'p90': 5090, 'p97': 5380},
    42: {'p3': 3825, 'p10': 4155, 'p50': 4810, 'p90': 5435, 'p97': 5745},
    43: {'p3': 4065, 'p10': 4415, 'p50': 5110, 'p90': 5770, 'p97': 6100},
    44: {'p3': 4295, 'p10': 4665, 'p50': 5400, 'p90': 6095, 'p97': 6445},
    45: {'p3': 4515, 'p10': 4905, 'p50': 5680, 'p90': 6410, 'p97': 6780},
    46: {'p3': 4725, 'p10': 5135, 'p50': 5950, 'p90': 6715, 'p97': 7105},
    47: {'p3': 4925, 'p10': 5355, 'p50': 6210, 'p90': 7010, 'p97': 7420},
    48: {'p3': 5115, 'p10': 5565, 'p50': 6460, 'p90': 7295, 'p97': 7725},
    49: {'p3': 5295, 'p10': 5765, 'p50': 6700, 'p90': 7570, 'p97': 8020},
    50: {'p3': 5470, 'p10': 5955, 'p50': 6935, 'p90': 7835, 'p97': 8305},
  };

  // ============================================
  // 체중 (Weight) - 여아 (g)
  // ============================================
  static const Map<int, Map<String, double>> weightGirls = {
    22: {'p3': 400, 'p10': 435, 'p50': 505, 'p90': 575, 'p97': 610},
    23: {'p3': 455, 'p10': 495, 'p50': 575, 'p90': 655, 'p97': 695},
    24: {'p3': 520, 'p10': 565, 'p50': 660, 'p90': 750, 'p97': 795},
    25: {'p3': 595, 'p10': 645, 'p50': 755, 'p90': 860, 'p97': 910},
    26: {'p3': 680, 'p10': 740, 'p50': 865, 'p90': 985, 'p97': 1040},
    27: {'p3': 775, 'p10': 845, 'p50': 990, 'p90': 1125, 'p97': 1190},
    28: {'p3': 885, 'p10': 965, 'p50': 1130, 'p90': 1285, 'p97': 1360},
    29: {'p3': 1005, 'p10': 1095, 'p50': 1285, 'p90': 1460, 'p97': 1545},
    30: {'p3': 1140, 'p10': 1240, 'p50': 1455, 'p90': 1655, 'p97': 1750},
    31: {'p3': 1285, 'p10': 1400, 'p50': 1640, 'p90': 1865, 'p97': 1975},
    32: {'p3': 1445, 'p10': 1575, 'p50': 1845, 'p90': 2095, 'p97': 2220},
    33: {'p3': 1620, 'p10': 1765, 'p50': 2070, 'p90': 2350, 'p97': 2485},
    34: {'p3': 1810, 'p10': 1970, 'p50': 2310, 'p90': 2620, 'p97': 2770},
    35: {'p3': 2015, 'p10': 2195, 'p50': 2570, 'p90': 2915, 'p97': 3080},
    36: {'p3': 2235, 'p10': 2430, 'p50': 2845, 'p90': 3225, 'p97': 3410},
    37: {'p3': 2465, 'p10': 2680, 'p50': 3135, 'p90': 3550, 'p97': 3755},
    38: {'p3': 2705, 'p10': 2940, 'p50': 3435, 'p90': 3890, 'p97': 4110},
    39: {'p3': 2950, 'p10': 3205, 'p50': 3745, 'p90': 4235, 'p97': 4475},
    40: {'p3': 3195, 'p10': 3470, 'p50': 4055, 'p90': 4585, 'p97': 4845},
    41: {'p3': 3435, 'p10': 3730, 'p50': 4360, 'p90': 4925, 'p97': 5205},
    42: {'p3': 3670, 'p10': 3985, 'p50': 4660, 'p90': 5260, 'p97': 5560},
    43: {'p3': 3900, 'p10': 4230, 'p50': 4950, 'p90': 5585, 'p97': 5905},
    44: {'p3': 4120, 'p10': 4470, 'p50': 5235, 'p90': 5900, 'p97': 6240},
    45: {'p3': 4335, 'p10': 4700, 'p50': 5510, 'p90': 6210, 'p97': 6565},
    46: {'p3': 4540, 'p10': 4920, 'p50': 5775, 'p90': 6510, 'p97': 6880},
    47: {'p3': 4735, 'p10': 5135, 'p50': 6035, 'p90': 6800, 'p97': 7185},
    48: {'p3': 4925, 'p10': 5340, 'p50': 6285, 'p90': 7085, 'p97': 7485},
    49: {'p3': 5105, 'p10': 5540, 'p50': 6530, 'p90': 7360, 'p97': 7775},
    50: {'p3': 5280, 'p10': 5730, 'p50': 6765, 'p90': 7625, 'p97': 8055},
  };

  // ============================================
  // 신장 (Length) - 남아 (cm)
  // ============================================
  static const Map<int, Map<String, double>> lengthBoys = {
    22: {'p3': 26.5, 'p10': 27.5, 'p50': 29.0, 'p90': 30.5, 'p97': 31.5},
    23: {'p3': 27.5, 'p10': 28.5, 'p50': 30.0, 'p90': 31.5, 'p97': 32.5},
    24: {'p3': 28.5, 'p10': 29.5, 'p50': 31.0, 'p90': 32.5, 'p97': 33.5},
    25: {'p3': 29.5, 'p10': 30.5, 'p50': 32.0, 'p90': 33.5, 'p97': 34.5},
    26: {'p3': 30.5, 'p10': 31.5, 'p50': 33.0, 'p90': 34.5, 'p97': 35.5},
    27: {'p3': 31.5, 'p10': 32.5, 'p50': 34.0, 'p90': 35.5, 'p97': 36.5},
    28: {'p3': 32.5, 'p10': 33.5, 'p50': 35.0, 'p90': 36.5, 'p97': 37.5},
    29: {'p3': 33.5, 'p10': 34.5, 'p50': 36.0, 'p90': 37.5, 'p97': 38.5},
    30: {'p3': 34.5, 'p10': 35.5, 'p50': 37.0, 'p90': 38.5, 'p97': 39.5},
    31: {'p3': 35.5, 'p10': 36.5, 'p50': 38.0, 'p90': 39.5, 'p97': 40.5},
    32: {'p3': 36.5, 'p10': 37.5, 'p50': 39.0, 'p90': 40.5, 'p97': 41.5},
    33: {'p3': 37.5, 'p10': 38.5, 'p50': 40.0, 'p90': 41.5, 'p97': 42.5},
    34: {'p3': 38.5, 'p10': 39.5, 'p50': 41.0, 'p90': 42.5, 'p97': 43.5},
    35: {'p3': 39.5, 'p10': 40.5, 'p50': 42.0, 'p90': 43.5, 'p97': 44.5},
    36: {'p3': 40.5, 'p10': 41.5, 'p50': 43.0, 'p90': 44.5, 'p97': 45.5},
    37: {'p3': 41.5, 'p10': 42.5, 'p50': 44.0, 'p90': 45.5, 'p97': 46.5},
    38: {'p3': 42.5, 'p10': 43.5, 'p50': 45.0, 'p90': 46.5, 'p97': 47.5},
    39: {'p3': 43.5, 'p10': 44.5, 'p50': 46.0, 'p90': 47.5, 'p97': 48.5},
    40: {'p3': 44.5, 'p10': 45.5, 'p50': 47.0, 'p90': 48.5, 'p97': 49.5},
    41: {'p3': 45.5, 'p10': 46.5, 'p50': 48.0, 'p90': 49.5, 'p97': 50.5},
    42: {'p3': 46.5, 'p10': 47.5, 'p50': 49.0, 'p90': 50.5, 'p97': 51.5},
    43: {'p3': 47.5, 'p10': 48.5, 'p50': 50.0, 'p90': 51.5, 'p97': 52.5},
    44: {'p3': 48.4, 'p10': 49.4, 'p50': 50.9, 'p90': 52.4, 'p97': 53.4},
    45: {'p3': 49.3, 'p10': 50.3, 'p50': 51.8, 'p90': 53.3, 'p97': 54.3},
    46: {'p3': 50.2, 'p10': 51.2, 'p50': 52.7, 'p90': 54.2, 'p97': 55.2},
    47: {'p3': 51.1, 'p10': 52.1, 'p50': 53.6, 'p90': 55.1, 'p97': 56.1},
    48: {'p3': 52.0, 'p10': 53.0, 'p50': 54.5, 'p90': 56.0, 'p97': 57.0},
    49: {'p3': 52.8, 'p10': 53.8, 'p50': 55.3, 'p90': 56.8, 'p97': 57.8},
    50: {'p3': 53.6, 'p10': 54.6, 'p50': 56.1, 'p90': 57.6, 'p97': 58.6},
  };

  // ============================================
  // 신장 (Length) - 여아 (cm)
  // ============================================
  static const Map<int, Map<String, double>> lengthGirls = {
    22: {'p3': 26.0, 'p10': 27.0, 'p50': 28.5, 'p90': 30.0, 'p97': 31.0},
    23: {'p3': 27.0, 'p10': 28.0, 'p50': 29.5, 'p90': 31.0, 'p97': 32.0},
    24: {'p3': 28.0, 'p10': 29.0, 'p50': 30.5, 'p90': 32.0, 'p97': 33.0},
    25: {'p3': 29.0, 'p10': 30.0, 'p50': 31.5, 'p90': 33.0, 'p97': 34.0},
    26: {'p3': 30.0, 'p10': 31.0, 'p50': 32.5, 'p90': 34.0, 'p97': 35.0},
    27: {'p3': 31.0, 'p10': 32.0, 'p50': 33.5, 'p90': 35.0, 'p97': 36.0},
    28: {'p3': 32.0, 'p10': 33.0, 'p50': 34.5, 'p90': 36.0, 'p97': 37.0},
    29: {'p3': 33.0, 'p10': 34.0, 'p50': 35.5, 'p90': 37.0, 'p97': 38.0},
    30: {'p3': 34.0, 'p10': 35.0, 'p50': 36.5, 'p90': 38.0, 'p97': 39.0},
    31: {'p3': 35.0, 'p10': 36.0, 'p50': 37.5, 'p90': 39.0, 'p97': 40.0},
    32: {'p3': 36.0, 'p10': 37.0, 'p50': 38.5, 'p90': 40.0, 'p97': 41.0},
    33: {'p3': 37.0, 'p10': 38.0, 'p50': 39.5, 'p90': 41.0, 'p97': 42.0},
    34: {'p3': 38.0, 'p10': 39.0, 'p50': 40.5, 'p90': 42.0, 'p97': 43.0},
    35: {'p3': 39.0, 'p10': 40.0, 'p50': 41.5, 'p90': 43.0, 'p97': 44.0},
    36: {'p3': 40.0, 'p10': 41.0, 'p50': 42.5, 'p90': 44.0, 'p97': 45.0},
    37: {'p3': 41.0, 'p10': 42.0, 'p50': 43.5, 'p90': 45.0, 'p97': 46.0},
    38: {'p3': 42.0, 'p10': 43.0, 'p50': 44.5, 'p90': 46.0, 'p97': 47.0},
    39: {'p3': 43.0, 'p10': 44.0, 'p50': 45.5, 'p90': 47.0, 'p97': 48.0},
    40: {'p3': 44.0, 'p10': 45.0, 'p50': 46.5, 'p90': 48.0, 'p97': 49.0},
    41: {'p3': 45.0, 'p10': 46.0, 'p50': 47.5, 'p90': 49.0, 'p97': 50.0},
    42: {'p3': 46.0, 'p10': 47.0, 'p50': 48.5, 'p90': 50.0, 'p97': 51.0},
    43: {'p3': 47.0, 'p10': 48.0, 'p50': 49.5, 'p90': 51.0, 'p97': 52.0},
    44: {'p3': 47.9, 'p10': 48.9, 'p50': 50.4, 'p90': 51.9, 'p97': 52.9},
    45: {'p3': 48.8, 'p10': 49.8, 'p50': 51.3, 'p90': 52.8, 'p97': 53.8},
    46: {'p3': 49.7, 'p10': 50.7, 'p50': 52.2, 'p90': 53.7, 'p97': 54.7},
    47: {'p3': 50.6, 'p10': 51.6, 'p50': 53.1, 'p90': 54.6, 'p97': 55.6},
    48: {'p3': 51.5, 'p10': 52.5, 'p50': 54.0, 'p90': 55.5, 'p97': 56.5},
    49: {'p3': 52.3, 'p10': 53.3, 'p50': 54.8, 'p90': 56.3, 'p97': 57.3},
    50: {'p3': 53.1, 'p10': 54.1, 'p50': 55.6, 'p90': 57.1, 'p97': 58.1},
  };

  // ============================================
  // 두위 (Head Circumference) - 남아 (cm)
  // ============================================
  static const Map<int, Map<String, double>> headCircumferenceBoys = {
    22: {'p3': 19.0, 'p10': 19.5, 'p50': 20.5, 'p90': 21.5, 'p97': 22.0},
    23: {'p3': 19.5, 'p10': 20.0, 'p50': 21.0, 'p90': 22.0, 'p97': 22.5},
    24: {'p3': 20.0, 'p10': 20.5, 'p50': 21.5, 'p90': 22.5, 'p97': 23.0},
    25: {'p3': 20.5, 'p10': 21.0, 'p50': 22.0, 'p90': 23.0, 'p97': 23.5},
    26: {'p3': 21.0, 'p10': 21.5, 'p50': 22.5, 'p90': 23.5, 'p97': 24.0},
    27: {'p3': 21.5, 'p10': 22.0, 'p50': 23.0, 'p90': 24.0, 'p97': 24.5},
    28: {'p3': 22.0, 'p10': 22.5, 'p50': 23.5, 'p90': 24.5, 'p97': 25.0},
    29: {'p3': 22.5, 'p10': 23.0, 'p50': 24.0, 'p90': 25.0, 'p97': 25.5},
    30: {'p3': 23.0, 'p10': 23.5, 'p50': 24.5, 'p90': 25.5, 'p97': 26.0},
    31: {'p3': 23.5, 'p10': 24.0, 'p50': 25.0, 'p90': 26.0, 'p97': 26.5},
    32: {'p3': 24.0, 'p10': 24.5, 'p50': 25.5, 'p90': 26.5, 'p97': 27.0},
    33: {'p3': 24.5, 'p10': 25.0, 'p50': 26.0, 'p90': 27.0, 'p97': 27.5},
    34: {'p3': 25.0, 'p10': 25.5, 'p50': 26.5, 'p90': 27.5, 'p97': 28.0},
    35: {'p3': 25.5, 'p10': 26.0, 'p50': 27.0, 'p90': 28.0, 'p97': 28.5},
    36: {'p3': 26.0, 'p10': 26.5, 'p50': 27.5, 'p90': 28.5, 'p97': 29.0},
    37: {'p3': 26.5, 'p10': 27.0, 'p50': 28.0, 'p90': 29.0, 'p97': 29.5},
    38: {'p3': 27.0, 'p10': 27.5, 'p50': 28.5, 'p90': 29.5, 'p97': 30.0},
    39: {'p3': 27.5, 'p10': 28.0, 'p50': 29.0, 'p90': 30.0, 'p97': 30.5},
    40: {'p3': 28.0, 'p10': 28.5, 'p50': 29.5, 'p90': 30.5, 'p97': 31.0},
    41: {'p3': 28.5, 'p10': 29.0, 'p50': 30.0, 'p90': 31.0, 'p97': 31.5},
    42: {'p3': 29.0, 'p10': 29.5, 'p50': 30.5, 'p90': 31.5, 'p97': 32.0},
    43: {'p3': 29.5, 'p10': 30.0, 'p50': 31.0, 'p90': 32.0, 'p97': 32.5},
    44: {'p3': 30.0, 'p10': 30.5, 'p50': 31.5, 'p90': 32.5, 'p97': 33.0},
    45: {'p3': 30.5, 'p10': 31.0, 'p50': 32.0, 'p90': 33.0, 'p97': 33.5},
    46: {'p3': 31.0, 'p10': 31.5, 'p50': 32.5, 'p90': 33.5, 'p97': 34.0},
    47: {'p3': 31.5, 'p10': 32.0, 'p50': 33.0, 'p90': 34.0, 'p97': 34.5},
    48: {'p3': 32.0, 'p10': 32.5, 'p50': 33.5, 'p90': 34.5, 'p97': 35.0},
    49: {'p3': 32.5, 'p10': 33.0, 'p50': 34.0, 'p90': 35.0, 'p97': 35.5},
    50: {'p3': 33.0, 'p10': 33.5, 'p50': 34.5, 'p90': 35.5, 'p97': 36.0},
  };

  // ============================================
  // 두위 (Head Circumference) - 여아 (cm)
  // ============================================
  static const Map<int, Map<String, double>> headCircumferenceGirls = {
    22: {'p3': 18.5, 'p10': 19.0, 'p50': 20.0, 'p90': 21.0, 'p97': 21.5},
    23: {'p3': 19.0, 'p10': 19.5, 'p50': 20.5, 'p90': 21.5, 'p97': 22.0},
    24: {'p3': 19.5, 'p10': 20.0, 'p50': 21.0, 'p90': 22.0, 'p97': 22.5},
    25: {'p3': 20.0, 'p10': 20.5, 'p50': 21.5, 'p90': 22.5, 'p97': 23.0},
    26: {'p3': 20.5, 'p10': 21.0, 'p50': 22.0, 'p90': 23.0, 'p97': 23.5},
    27: {'p3': 21.0, 'p10': 21.5, 'p50': 22.5, 'p90': 23.5, 'p97': 24.0},
    28: {'p3': 21.5, 'p10': 22.0, 'p50': 23.0, 'p90': 24.0, 'p97': 24.5},
    29: {'p3': 22.0, 'p10': 22.5, 'p50': 23.5, 'p90': 24.5, 'p97': 25.0},
    30: {'p3': 22.5, 'p10': 23.0, 'p50': 24.0, 'p90': 25.0, 'p97': 25.5},
    31: {'p3': 23.0, 'p10': 23.5, 'p50': 24.5, 'p90': 25.5, 'p97': 26.0},
    32: {'p3': 23.5, 'p10': 24.0, 'p50': 25.0, 'p90': 26.0, 'p97': 26.5},
    33: {'p3': 24.0, 'p10': 24.5, 'p50': 25.5, 'p90': 26.5, 'p97': 27.0},
    34: {'p3': 24.5, 'p10': 25.0, 'p50': 26.0, 'p90': 27.0, 'p97': 27.5},
    35: {'p3': 25.0, 'p10': 25.5, 'p50': 26.5, 'p90': 27.5, 'p97': 28.0},
    36: {'p3': 25.5, 'p10': 26.0, 'p50': 27.0, 'p90': 28.0, 'p97': 28.5},
    37: {'p3': 26.0, 'p10': 26.5, 'p50': 27.5, 'p90': 28.5, 'p97': 29.0},
    38: {'p3': 26.5, 'p10': 27.0, 'p50': 28.0, 'p90': 29.0, 'p97': 29.5},
    39: {'p3': 27.0, 'p10': 27.5, 'p50': 28.5, 'p90': 29.5, 'p97': 30.0},
    40: {'p3': 27.5, 'p10': 28.0, 'p50': 29.0, 'p90': 30.0, 'p97': 30.5},
    41: {'p3': 28.0, 'p10': 28.5, 'p50': 29.5, 'p90': 30.5, 'p97': 31.0},
    42: {'p3': 28.5, 'p10': 29.0, 'p50': 30.0, 'p90': 31.0, 'p97': 31.5},
    43: {'p3': 29.0, 'p10': 29.5, 'p50': 30.5, 'p90': 31.5, 'p97': 32.0},
    44: {'p3': 29.5, 'p10': 30.0, 'p50': 31.0, 'p90': 32.0, 'p97': 32.5},
    45: {'p3': 30.0, 'p10': 30.5, 'p50': 31.5, 'p90': 32.5, 'p97': 33.0},
    46: {'p3': 30.5, 'p10': 31.0, 'p50': 32.0, 'p90': 33.0, 'p97': 33.5},
    47: {'p3': 31.0, 'p10': 31.5, 'p50': 32.5, 'p90': 33.5, 'p97': 34.0},
    48: {'p3': 31.5, 'p10': 32.0, 'p50': 33.0, 'p90': 34.0, 'p97': 34.5},
    49: {'p3': 32.0, 'p10': 32.5, 'p50': 33.5, 'p90': 34.5, 'p97': 35.0},
    50: {'p3': 32.5, 'p10': 33.0, 'p50': 34.0, 'p90': 35.0, 'p97': 35.5},
  };

  /// 재태 연령 범위 확인
  static bool isValidGestationalAge(int weeks) {
    return weeks >= 22 && weeks <= 50;
  }

  /// 백분위수 계산 (선형 보간)
  ///
  /// Parameters:
  /// - [gestationalWeeks]: 재태 연령 (주)
  /// - [isBoy]: 남아 여부
  /// - [measurementType]: 측정 유형 ('weight', 'length', 'head')
  ///
  /// Returns: 백분위수 데이터 맵 또는 null
  static Map<String, double>? getPercentiles({
    required int gestationalWeeks,
    required bool isBoy,
    required String measurementType,
  }) {
    if (!isValidGestationalAge(gestationalWeeks)) {
      return null;
    }

    Map<int, Map<String, double>>? data;

    switch (measurementType) {
      case 'weight':
        data = isBoy ? weightBoys : weightGirls;
        break;
      case 'length':
        data = isBoy ? lengthBoys : lengthGirls;
        break;
      case 'head':
        data = isBoy ? headCircumferenceBoys : headCircumferenceGirls;
        break;
      default:
        return null;
    }

    return data[gestationalWeeks];
  }

  /// 측정값에 해당하는 백분위수 추정
  ///
  /// Parameters:
  /// - [gestationalWeeks]: 재태 연령 (주)
  /// - [value]: 측정값
  /// - [isBoy]: 남아 여부
  /// - [measurementType]: 측정 유형
  ///
  /// Returns: 추정 백분위수 (0-100) 또는 null
  static double? estimatePercentile({
    required int gestationalWeeks,
    required double value,
    required bool isBoy,
    required String measurementType,
  }) {
    final percentiles = getPercentiles(
      gestationalWeeks: gestationalWeeks,
      isBoy: isBoy,
      measurementType: measurementType,
    );

    if (percentiles == null) return null;

    // 백분위수 구간 확인
    if (value < percentiles['p3']!) {
      return 3.0 * (value / percentiles['p3']!);
    } else if (value < percentiles['p10']!) {
      final ratio = (value - percentiles['p3']!) /
          (percentiles['p10']! - percentiles['p3']!);
      return 3.0 + (7.0 * ratio);
    } else if (value < percentiles['p50']!) {
      final ratio = (value - percentiles['p10']!) /
          (percentiles['p50']! - percentiles['p10']!);
      return 10.0 + (40.0 * ratio);
    } else if (value < percentiles['p90']!) {
      final ratio = (value - percentiles['p50']!) /
          (percentiles['p90']! - percentiles['p50']!);
      return 50.0 + (40.0 * ratio);
    } else if (value < percentiles['p97']!) {
      final ratio = (value - percentiles['p90']!) /
          (percentiles['p97']! - percentiles['p90']!);
      return 90.0 + (7.0 * ratio);
    } else {
      final ratio = value / percentiles['p97']!;
      return 97.0 + (3.0 * (ratio - 1.0));
    }
  }
}
