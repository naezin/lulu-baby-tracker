#!/bin/bash

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Lulu - ë¹Œë“œ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸
# ìš©ë„: ë¹Œë“œ ìºì‹œ ë° ì•„í‹°íŒ©íŠ¸ ì™„ì „ ì •ë¦¬ë¡œ ë¹Œë“œ ì„±ëŠ¥ ê°œì„ 
# ì‚¬ìš©: ./scripts/clean_build.sh
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e  # ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨

echo "ğŸ§¹ Lulu ë¹Œë“œ ì •ë¦¬ ì‹œì‘..."
echo ""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. Flutter Clean
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo "ğŸ“¦ Flutter clean..."
flutter clean
echo "âœ… Flutter clean ì™„ë£Œ"
echo ""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. iOS íŠ¹í™” ì •ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [ -d "ios" ]; then
  echo "ğŸ iOS ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ ì •ë¦¬..."
  cd ios

  # Pods ë””ë ‰í† ë¦¬ ì‚­ì œ
  if [ -d "Pods" ]; then
    echo "  - Pods ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
    rm -rf Pods/
  fi

  # iOS ë¹Œë“œ ë””ë ‰í† ë¦¬ ì‚­ì œ
  if [ -d "build" ]; then
    echo "  - iOS build ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
    rm -rf build/
  fi

  # Podfile.lock ì‚­ì œ
  if [ -f "Podfile.lock" ]; then
    echo "  - Podfile.lock ì‚­ì œ ì¤‘..."
    rm Podfile.lock
  fi

  # .symlinks ì •ë¦¬
  if [ -d ".symlinks" ]; then
    echo "  - .symlinks ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
    rm -rf .symlinks/
  fi

  # Pod deintegrate (cocoapods-deintegrate ì„¤ì¹˜ í•„ìš”)
  if command -v pod &> /dev/null; then
    echo "  - Pod deintegrate ì‹¤í–‰ ì¤‘..."
    pod deintegrate || echo "  âš ï¸  Pod deintegrate ì‹¤íŒ¨ (ë¬´ì‹œí•˜ê³  ê³„ì†)"
  fi

  cd ..
  echo "âœ… iOS ì •ë¦¬ ì™„ë£Œ"
  echo ""
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. Android íŠ¹í™” ì •ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [ -d "android" ]; then
  echo "ğŸ¤– Android ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ ì •ë¦¬..."

  # Gradle ìºì‹œ ì •ë¦¬
  if [ -d "android/.gradle" ]; then
    echo "  - Gradle ìºì‹œ ì‚­ì œ ì¤‘..."
    rm -rf android/.gradle/
  fi

  # Android ë¹Œë“œ ë””ë ‰í† ë¦¬ ì‚­ì œ
  if [ -d "android/build" ]; then
    echo "  - Android build ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
    rm -rf android/build/
  fi

  if [ -d "android/app/build" ]; then
    echo "  - Android app build ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
    rm -rf android/app/build/
  fi

  echo "âœ… Android ì •ë¦¬ ì™„ë£Œ"
  echo ""
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. Dart/Flutter ìºì‹œ ì •ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo "ğŸ“‚ Dart ìºì‹œ ì •ë¦¬..."

# .dart_tool ë””ë ‰í† ë¦¬ ì‚­ì œ
if [ -d ".dart_tool" ]; then
  echo "  - .dart_tool ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
  rm -rf .dart_tool/
fi

# build ë””ë ‰í† ë¦¬ ì‚­ì œ
if [ -d "build" ]; then
  echo "  - build ë””ë ‰í† ë¦¬ ì‚­ì œ ì¤‘..."
  rm -rf build/
fi

echo "âœ… Dart ìºì‹œ ì •ë¦¬ ì™„ë£Œ"
echo ""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. Pub Cache Repair (ì„ íƒì )
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
read -p "â“ Flutter pub cache repairë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
  echo "ğŸ”§ Pub cache repair ì‹¤í–‰ ì¤‘..."
  flutter pub cache repair
  echo "âœ… Pub cache repair ì™„ë£Œ"
  echo ""
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 6. ì™„ë£Œ ì•ˆë‚´
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… ë¹Œë“œ ì •ë¦¬ ì™„ë£Œ!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ë‹¤ìŒ ë‹¨ê³„:"
echo "  1. flutter pub get          - ì˜ì¡´ì„± ì¬ì„¤ì¹˜"
echo "  2. cd ios && pod install    - iOS Pod ì¬ì„¤ì¹˜ (iOS ê°œë°œ ì‹œ)"
echo "  3. flutter run              - ì•± ì‹¤í–‰"
echo ""
echo "ğŸ’¡ Tip: ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì›” 1íšŒ ì‹¤í–‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
echo ""
